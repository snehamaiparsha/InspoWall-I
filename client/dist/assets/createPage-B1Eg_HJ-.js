import{c as Y,j as t,I as k,R as g,r as d,u as J,a as W,b as q}from"./index-DqcJGOsq.js";import{u as Q,a as V}from"./useMutation-Bp5n_cWk.js";import"./useBaseQuery-zgPbw50b.js";const E=Y(e=>({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{height:0,orientation:"",size:"original",backgroundColor:"#008080"},setSelectedLayer:n=>e({selectedLayer:n}),setTextOptions:n=>e({textOptions:n}),addText:()=>e({textOptions:{text:"Add text",fontSize:48,color:"#000000",top:48,left:0}}),setCanvasOptions:n=>e({canvasOptions:n}),resetStore:()=>e({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{height:0,orientation:"",size:"original",backgroundColor:"#008080"}})})),Z=()=>{const{selectedLayer:e,setSelectedLayer:n,addText:r,canvasOptions:o}=E(),a=s=>{n(s),s==="text"&&r()};return t.jsxs("div",{className:"layers",children:[t.jsxs("div",{className:"layersTitle",children:[t.jsx("h3",{children:"Layers"}),t.jsx("p",{children:"Select a layer to edit"})]}),t.jsxs("div",{onClick:()=>a("text"),className:`layer ${e==="text"?"selected":""}`,children:[t.jsx("div",{className:"layerImage",children:t.jsx(k,{path:"/general/text.png",alt:"",w:48,h:48})}),t.jsx("span",{children:"Add Text"})]}),t.jsxs("div",{onClick:()=>a("canvas"),className:`layer ${e==="canvas"?"selected":""}`,children:[t.jsx("div",{className:"layerImage",style:{backgroundColor:o.backgroundColor}}),t.jsx("span",{children:"Canvas"})]})]})};function M(){return(M=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function A(e,n){if(e==null)return{};var r,o,a={},s=Object.keys(e);for(o=0;o<s.length;o++)n.indexOf(r=s[o])>=0||(a[r]=e[r]);return a}function R(e){var n=d.useRef(e),r=d.useRef(function(o){n.current&&n.current(o)});return n.current=e,r.current}var O=function(e,n,r){return n===void 0&&(n=0),r===void 0&&(r=1),e>r?r:e<n?n:e},w=function(e){return"touches"in e},B=function(e){return e&&e.ownerDocument.defaultView||self},P=function(e,n,r){var o=e.getBoundingClientRect(),a=w(n)?function(s,l){for(var c=0;c<s.length;c++)if(s[c].identifier===l)return s[c];return s[0]}(n.touches,r):n;return{left:O((a.pageX-(o.left+B(e).pageXOffset))/o.width),top:O((a.pageY-(o.top+B(e).pageYOffset))/o.height)}},H=function(e){!w(e)&&e.preventDefault()},U=g.memo(function(e){var n=e.onMove,r=e.onKey,o=A(e,["onMove","onKey"]),a=d.useRef(null),s=R(n),l=R(r),c=d.useRef(null),h=d.useRef(!1),u=d.useMemo(function(){var _=function(j){H(j),(w(j)?j.touches.length>0:j.buttons>0)&&a.current?s(P(a.current,j,c.current)):C(!1)},b=function(){return C(!1)};function C(j){var v=h.current,N=B(a.current),y=j?N.addEventListener:N.removeEventListener;y(v?"touchmove":"mousemove",_),y(v?"touchend":"mouseup",b)}return[function(j){var v=j.nativeEvent,N=a.current;if(N&&(H(v),!function(L,F){return F&&!w(L)}(v,h.current)&&N)){if(w(v)){h.current=!0;var y=v.changedTouches||[];y.length&&(c.current=y[0].identifier)}N.focus(),s(P(N,v,c.current)),C(!0)}},function(j){var v=j.which||j.keyCode;v<37||v>40||(j.preventDefault(),l({left:v===39?.05:v===37?-.05:0,top:v===40?.05:v===38?-.05:0}))},C]},[l,s]),p=u[0],i=u[1],m=u[2];return d.useEffect(function(){return m},[m]),g.createElement("div",M({},o,{onTouchStart:p,onMouseDown:p,className:"react-colorful__interactive",ref:a,onKeyDown:i,tabIndex:0,role:"slider"}))}),D=function(e){return e.filter(Boolean).join(" ")},K=function(e){var n=e.color,r=e.left,o=e.top,a=o===void 0?.5:o,s=D(["react-colorful__pointer",e.className]);return g.createElement("div",{className:s,style:{top:100*a+"%",left:100*r+"%"}},g.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:n}}))},x=function(e,n,r){return n===void 0&&(n=0),r===void 0&&(r=Math.pow(10,n)),Math.round(r*e)/r},G=function(e){return ae(z(e))},z=function(e){return e[0]==="#"&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?x(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:e.length===8?x(parseInt(e.substring(6,8),16)/255,2):1}},ee=function(e){return re(ne(e))},te=function(e){var n=e.s,r=e.v,o=e.a,a=(200-n)*r/100;return{h:x(e.h),s:x(a>0&&a<200?n*r/100/(a<=100?a:200-a)*100:0),l:x(a/2),a:x(o,2)}},T=function(e){var n=te(e);return"hsl("+n.h+", "+n.s+"%, "+n.l+"%)"},ne=function(e){var n=e.h,r=e.s,o=e.v,a=e.a;n=n/360*6,r/=100,o/=100;var s=Math.floor(n),l=o*(1-r),c=o*(1-(n-s)*r),h=o*(1-(1-n+s)*r),u=s%6;return{r:x(255*[o,c,l,l,h,o][u]),g:x(255*[h,o,o,c,l,l][u]),b:x(255*[l,l,h,o,o,c][u]),a:x(a,2)}},S=function(e){var n=e.toString(16);return n.length<2?"0"+n:n},re=function(e){var n=e.r,r=e.g,o=e.b,a=e.a,s=a<1?S(x(255*a)):"";return"#"+S(n)+S(r)+S(o)+s},ae=function(e){var n=e.r,r=e.g,o=e.b,a=e.a,s=Math.max(n,r,o),l=s-Math.min(n,r,o),c=l?s===n?(r-o)/l:s===r?2+(o-n)/l:4+(n-r)/l:0;return{h:x(60*(c<0?c+6:c)),s:x(s?l/s*100:0),v:x(s/255*100),a}},oe=g.memo(function(e){var n=e.hue,r=e.onChange,o=D(["react-colorful__hue",e.className]);return g.createElement("div",{className:o},g.createElement(U,{onMove:function(a){r({h:360*a.left})},onKey:function(a){r({h:O(n+360*a.left,0,360)})},"aria-label":"Hue","aria-valuenow":x(n),"aria-valuemax":"360","aria-valuemin":"0"},g.createElement(K,{className:"react-colorful__hue-pointer",left:n/360,color:T({h:n,s:100,v:100,a:1})})))}),se=g.memo(function(e){var n=e.hsva,r=e.onChange,o={backgroundColor:T({h:n.h,s:100,v:100,a:1})};return g.createElement("div",{className:"react-colorful__saturation",style:o},g.createElement(U,{onMove:function(a){r({s:100*a.left,v:100-100*a.top})},onKey:function(a){r({s:O(n.s+100*a.left,0,100),v:O(n.v-100*a.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+x(n.s)+"%, Brightness "+x(n.v)+"%"},g.createElement(K,{className:"react-colorful__saturation-pointer",top:1-n.v/100,left:n.s/100,color:T(n)})))}),X=function(e,n){if(e===n)return!0;for(var r in e)if(e[r]!==n[r])return!1;return!0},ie=function(e,n){return e.toLowerCase()===n.toLowerCase()||X(z(e),z(n))};function le(e,n,r){var o=R(r),a=d.useState(function(){return e.toHsva(n)}),s=a[0],l=a[1],c=d.useRef({color:n,hsva:s});d.useEffect(function(){if(!e.equal(n,c.current.color)){var u=e.toHsva(n);c.current={hsva:u,color:n},l(u)}},[n,e]),d.useEffect(function(){var u;X(s,c.current.hsva)||e.equal(u=e.fromHsva(s),c.current.color)||(c.current={hsva:s,color:u},o(u))},[s,e,o]);var h=d.useCallback(function(u){l(function(p){return Object.assign({},p,u)})},[]);return[s,h]}var ce=typeof window<"u"?d.useLayoutEffect:d.useEffect,de=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},I=new Map,ue=function(e){ce(function(){var n=e.current?e.current.ownerDocument:document;if(n!==void 0&&!I.has(n)){var r=n.createElement("style");r.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,I.set(n,r);var o=de();o&&r.setAttribute("nonce",o),n.head.appendChild(r)}},[])},he=function(e){var n=e.className,r=e.colorModel,o=e.color,a=o===void 0?r.defaultColor:o,s=e.onChange,l=A(e,["className","colorModel","color","onChange"]),c=d.useRef(null);ue(c);var h=le(r,a,s),u=h[0],p=h[1],i=D(["react-colorful",n]);return g.createElement("div",M({},l,{ref:c,className:i}),g.createElement(se,{hsva:u,onChange:p}),g.createElement(oe,{hue:u.h,onChange:p,className:"react-colorful__last-control"}))},fe={defaultColor:"000",toHsva:G,fromHsva:function(e){return ee({h:e.h,s:e.s,v:e.v,a:1})},equal:ie},$=function(e){return g.createElement(he,M({},e,{colorModel:fe}))};const pe=[{name:"1:2",width:1,height:2},{name:"9:16",width:9,height:16},{name:"2:3",width:2,height:3},{name:"3:4",width:3,height:4},{name:"4:5",width:4,height:5},{name:"1:1",width:1,height:1}],me=[{name:"2:1",width:2,height:1},{name:"16:9",width:16,height:9},{name:"3:2",width:3,height:2},{name:"4:3",width:4,height:3},{name:"5:4",width:5,height:4},{name:"1:1",width:1,height:1}],ve=({previewImg:e})=>{const{selectedLayer:n,textOptions:r,setTextOptions:o,canvasOptions:a,setCanvasOptions:s}=E(),[l,c]=d.useState(!1),h=e.width<e.height?"portrait":"landscape",u=i=>{let m;h===i?m=375*e.height/e.width:m=375*e.width/e.height,s({...a,orientation:i,size:"original",height:m})},p=i=>{let m;i==="original"?h===a.orientation?m=375*e.height/e.width:m=375*e.width/e.height:m=375*i.height/i.width,s({...a,size:i==="original"?"original":i.name,height:m})};return t.jsx("div",{className:"options",children:n==="text"?t.jsxs("div",{className:"",children:[t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Font Size"}),t.jsx("input",{type:"number",value:r.fontSize,onChange:i=>o({...r,fontSize:i.target.value})})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Color"}),t.jsxs("div",{className:"textColor",children:[t.jsx("div",{className:"colorPreview",style:{backgroundColor:r.color},onClick:()=>c(i=>!i)}),l&&t.jsx("div",{className:"colorPicker",children:t.jsx($,{color:r.color,onChange:i=>o({...r,color:i})})})]})]})]}):t.jsxs("div",{className:"",children:[t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Orientation"}),t.jsxs("div",{className:"orientations",children:[t.jsx("div",{className:`orientation ${a.orientation==="portrait"?"selected":""}`,onClick:()=>u("portrait"),children:"P"}),t.jsx("div",{className:`orientation ${a.orientation==="landscape"?"selected":""}`,onClick:()=>u("landscape"),children:"L"})]})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Size"}),t.jsxs("div",{className:"sizes",children:[t.jsx("div",{className:`size ${a.size==="original"?"selected":""}`,onClick:()=>p("original"),children:"Original"}),a.orientation==="portrait"?t.jsx(t.Fragment,{children:pe.map(i=>t.jsx("div",{className:`size ${a.size===i.name?"selected":""}`,onClick:()=>p(i),children:i.name},i.name))}):t.jsx(t.Fragment,{children:me.map(i=>t.jsx("div",{className:`size ${a.size===i.name?"selected":""}`,onClick:()=>p(i),children:i.name},i.name))})]})]}),t.jsxs("div",{className:"editingOption",children:[t.jsx("span",{children:"Background Color"}),t.jsx("div",{className:"bgColor",children:t.jsxs("div",{className:"textColor",children:[t.jsx("div",{className:"colorPreview",style:{backgroundColor:a.backgroundColor},onClick:()=>c(i=>!i)}),l&&t.jsx("div",{className:"colorPicker",children:t.jsx($,{color:a.backgroundColor,onChange:i=>s({...a,backgroundColor:i})})})]})})]})]})})},xe=({previewImg:e})=>{const{setSelectedLayer:n,textOptions:r,setTextOptions:o,canvasOptions:a,setCanvasOptions:s}=E();d.useEffect(()=>{if(a.height===0){const b=375*e.height/e.width;s({...a,height:b,orientation:b>375?"portrait":"landscape"})}},[e,a,s]);const l=d.useRef(null),c=d.useRef(null),h=d.useRef(!1),u=d.useRef({x:0,y:0}),p=b=>{h.current&&o({...r,left:b.clientX-u.current.x,top:b.clientY-u.current.y})},i=()=>{h.current=!1},m=()=>{h.current=!1},_=b=>{n("text"),h.current=!0,u.current={x:b.clientX-r.left,y:b.clientY-r.top}};return t.jsx("div",{className:"workspace",children:t.jsxs("div",{className:"canvas",style:{height:a.height,backgroundColor:a.backgroundColor},onMouseMove:p,onMouseUp:i,onMouseLeave:m,ref:c,children:[t.jsx("img",{src:e.url,alt:""}),r.text&&t.jsxs("div",{className:"text",style:{left:r.left,top:r.top,fontSize:`${r.fontSize}px`},ref:l,onMouseDown:_,children:[t.jsx("input",{type:"text",value:r.text,onChange:b=>o({...r,text:b.target.value}),style:{color:r.color}}),t.jsx("div",{className:"deleteTextButton",onClick:()=>o({...r,text:""}),children:t.jsx(k,{path:"/general/delete.svg",alt:""})})]})]})})},ge=({previewImg:e})=>t.jsxs("div",{className:"editor",children:[t.jsx(Z,{previewImg:e}),t.jsx(xe,{previewImg:e}),t.jsx(ve,{previewImg:e})]}),je=({setIsNewBoardOpen:e,setNewBoard:n})=>{const r=o=>{o.preventDefault();const a=o.target[0].value;n(a),e(!1)};return t.jsx("div",{className:"boardForm",children:t.jsxs("div",{className:"boardFormContainer",children:[t.jsx("div",{className:"boardFormClose",onClick:()=>e(!1),children:t.jsx(k,{path:"/general/cancel.svg",alt:"",w:20,h:20})}),t.jsxs("form",{onSubmit:r,children:[t.jsx("h1",{children:"Create a new board"}),t.jsx("input",{type:"text",placeholder:"Board Title"}),t.jsx("button",{children:"Create"})]})]})})},be=async e=>(await q.post("/pins",e)).data,_e=()=>{const{currentUser:e}=J(),n=W(),r=d.useRef(),{textOptions:o,canvasOptions:a,resetStore:s}=E(),[l,c]=d.useState(null),[h,u]=d.useState({url:"",width:0,height:0}),[p,i]=d.useState(!1),[m,_]=d.useState(""),[b,C]=d.useState(!1);d.useEffect(()=>{e||n("/auth")},[n,e]),d.useEffect(()=>{if(l){const f=new Image;f.src=URL.createObjectURL(l),f.onload=()=>{u({url:URL.createObjectURL(l),width:f.width,height:f.height})}}},[l]);const j=Q({mutationFn:be,onSuccess:f=>{s(),n(`/pin/${f._id}`)}}),v=async()=>{if(p)i(!1);else{const f=new FormData(r.current);f.append("media",l),f.append("textOptions",JSON.stringify(o)),f.append("canvasOptions",JSON.stringify(a)),f.append("newBoard",m),j.mutate(f)}},{data:N,isPending:y,error:L}=V({queryKey:["formBoards"],queryFn:()=>q.get("/boards").then(f=>f.data)}),F=()=>{C(f=>!f)};return t.jsxs("div",{className:"createPage",children:[t.jsxs("div",{className:"createTop",children:[t.jsx("h1",{children:p?"Design your Pin":"Create Pin"}),t.jsx("button",{onClick:v,children:p?"Done":"Publish"})]}),p?t.jsx(ge,{previewImg:h}):t.jsxs("div",{className:"createBottom",children:[h.url?t.jsxs("div",{className:"preview",children:[t.jsx("img",{src:h.url,alt:""}),t.jsx("div",{className:"editIcon",onClick:()=>i(!0),children:t.jsx(k,{path:"/general/edit.svg",alt:""})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("label",{htmlFor:"file",className:"upload",children:[t.jsxs("div",{className:"uploadTitle",children:[t.jsx(k,{path:"/general/upload.svg",alt:""}),t.jsx("span",{children:"Choose a file"})]}),t.jsx("div",{className:"uploadInfo",children:"We recommend using high quality .jpg files less than 20 MB or .mp4 files less than 200 MB."})]}),t.jsx("input",{type:"file",id:"file",hidden:!0,onChange:f=>c(f.target.files[0])})]}),t.jsxs("form",{className:"createForm",ref:r,children:[t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"title",children:"Title"}),t.jsx("input",{type:"text",placeholder:"Add a title",name:"title",id:"title"})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"description",children:"Description"}),t.jsx("textarea",{rows:6,type:"text",placeholder:"Add a detailed description",name:"description",id:"description"})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"link",children:"Link"}),t.jsx("input",{type:"text",placeholder:"Add a link",name:"link",id:"link"})]}),(!y||!L)&&t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"board",children:"Board"}),t.jsxs("select",{name:"board",id:"board",children:[t.jsx("option",{value:"",children:"Choose a board"}),N==null?void 0:N.map(f=>t.jsx("option",{value:f._id,children:f.title},f._id))]}),t.jsxs("div",{className:"newBoard",children:[m&&t.jsx("div",{className:"newBoardContainer",children:t.jsx("div",{className:"newBoardItem",children:m})}),t.jsx("div",{className:"createBoardButton",onClick:F,children:"Create new board"})]})]}),t.jsxs("div",{className:"createFormItem",children:[t.jsx("label",{htmlFor:"tags",children:"Tagged topics"}),t.jsx("input",{type:"text",placeholder:"Add tags",name:"tags",id:"tags"}),t.jsx("small",{children:"Don't worry, people won't see your tags"})]})]}),b&&t.jsx(je,{setIsNewBoardOpen:C,setNewBoard:_})]})]})};export{_e as default};
